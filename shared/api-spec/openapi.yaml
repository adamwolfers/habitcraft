openapi: 3.0.3
info:
  title: Habit Tracker API
  description: |
    REST API specification for the Habit Tracker application.
    All backend implementations should follow this specification.
  version: 1.0.0
  contact:
    name: API Support
  license:
    name: MIT

servers:
  - url: http://localhost:3000/api/v1
    description: Local development server
  - url: https://api.habittracker.example.com/v1
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Auth
    description: Authentication and authorization
  - name: Users
    description: User management
  - name: Habits
    description: Habit CRUD operations
  - name: Completions
    description: Habit completion tracking
  - name: Statistics
    description: Statistics and analytics

paths:
  /health:
    get:
      tags:
        - Health
      summary: Health check
      description: Returns API health status
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time
                  version:
                    type: string
                    example: 1.0.0

  /hello:
    get:
      tags:
        - Health
      summary: Hello World endpoint
      description: Simple hello world response for testing
      operationId: helloWorld
      responses:
        '200':
          description: Successful response
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Hello World!

  /auth/register:
    post:
      tags:
        - Auth
      summary: Register new user
      description: Create a new user account
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - name
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: SecurePass123!
                name:
                  type: string
                  example: John Doe
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: Email already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /auth/login:
    post:
      tags:
        - Auth
      summary: Login user
      description: Authenticate user and return JWT token
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: SecurePass123!
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /users/me:
    get:
      tags:
        - Users
      summary: Get current user
      description: Get the authenticated user's profile
      operationId: getCurrentUser
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /habits:
    get:
      tags:
        - Habits
      summary: List habits
      description: Get all habits for the authenticated user
      operationId: listHabits
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          description: Filter by habit status
          schema:
            type: string
            enum: [active, archived]
      responses:
        '200':
          description: List of habits
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Habit'
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Habits
      summary: Create habit
      description: Create a new habit
      operationId: createHabit
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitInput'
      responses:
        '201':
          description: Habit created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Habit'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /habits/{habitId}:
    get:
      tags:
        - Habits
      summary: Get habit
      description: Get a specific habit by ID
      operationId: getHabit
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/HabitId'
      responses:
        '200':
          description: Habit details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Habit'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags:
        - Habits
      summary: Update habit
      description: Update an existing habit
      operationId: updateHabit
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/HabitId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitInput'
      responses:
        '200':
          description: Habit updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Habit'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Habits
      summary: Delete habit
      description: Delete a habit
      operationId: deleteHabit
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/HabitId'
      responses:
        '204':
          description: Habit deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /habits/{habitId}/completions:
    get:
      tags:
        - Completions
      summary: List completions
      description: Get all completions for a habit
      operationId: listCompletions
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/HabitId'
        - name: startDate
          in: query
          description: Filter completions from this date
          schema:
            type: string
            format: date
        - name: endDate
          in: query
          description: Filter completions until this date
          schema:
            type: string
            format: date
      responses:
        '200':
          description: List of completions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Completion'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Completions
      summary: Mark habit complete
      description: Mark a habit as completed for a specific date
      operationId: createCompletion
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/HabitId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - date
              properties:
                date:
                  type: string
                  format: date
                  example: "2024-01-15"
                notes:
                  type: string
                  example: "Went for a 30-minute run"
      responses:
        '201':
          description: Completion recorded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Completion'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: Already completed for this date
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /habits/{habitId}/completions/{date}:
    delete:
      tags:
        - Completions
      summary: Remove completion
      description: Remove a habit completion for a specific date
      operationId: deleteCompletion
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/HabitId'
        - name: date
          in: path
          required: true
          description: Date of the completion to remove
          schema:
            type: string
            format: date
      responses:
        '204':
          description: Completion removed
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /habits/{habitId}/statistics:
    get:
      tags:
        - Statistics
      summary: Get habit statistics
      description: Get statistics and analytics for a habit
      operationId: getHabitStatistics
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/HabitId'
      responses:
        '200':
          description: Habit statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Statistics'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  parameters:
    HabitId:
      name: habitId
      in: path
      required: true
      description: Habit identifier
      schema:
        type: string
        format: uuid

  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426614174000
        email:
          type: string
          format: email
          example: user@example.com
        name:
          type: string
          example: John Doe
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        token:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...

    HabitInput:
      type: object
      required:
        - name
        - frequency
      properties:
        name:
          type: string
          example: Morning Exercise
          minLength: 1
          maxLength: 100
        description:
          type: string
          example: 30 minutes of cardio exercise
          maxLength: 500
        frequency:
          type: string
          enum: [daily, weekly, custom]
          example: daily
        targetDays:
          type: array
          description: Days of the week for weekly habits (0=Sunday, 6=Saturday)
          items:
            type: integer
            minimum: 0
            maximum: 6
          example: [1, 3, 5]
        color:
          type: string
          pattern: '^#[0-9A-Fa-f]{6}$'
          example: "#3B82F6"
        icon:
          type: string
          example: "üèÉ"

    Habit:
      allOf:
        - $ref: '#/components/schemas/HabitInput'
        - type: object
          properties:
            id:
              type: string
              format: uuid
            userId:
              type: string
              format: uuid
            status:
              type: string
              enum: [active, archived]
              example: active
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    Completion:
      type: object
      properties:
        id:
          type: string
          format: uuid
        habitId:
          type: string
          format: uuid
        date:
          type: string
          format: date
          example: "2024-01-15"
        notes:
          type: string
          example: "Went for a 30-minute run"
        createdAt:
          type: string
          format: date-time

    Statistics:
      type: object
      properties:
        habitId:
          type: string
          format: uuid
        currentStreak:
          type: integer
          description: Current consecutive days/weeks completed
          example: 7
        longestStreak:
          type: integer
          description: Longest streak ever achieved
          example: 21
        totalCompletions:
          type: integer
          description: Total number of completions
          example: 45
        completionRate:
          type: number
          format: float
          description: Percentage of target days completed
          example: 85.5
        lastCompletedDate:
          type: string
          format: date
          example: "2024-01-15"

    Error:
      type: object
      properties:
        error:
          type: string
          example: Resource not found
        message:
          type: string
          example: The requested habit does not exist
        statusCode:
          type: integer
          example: 404

  responses:
    BadRequest:
      description: Bad request - validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Unauthorized - invalid or missing token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
